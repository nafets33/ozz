(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,a){e.exports=a(41)},33:function(e,t,a){},41:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(17),l=a.n(o),i=a(10),s=a(53),c=a(5),p=a.n(c);var d=e=>{let{commands:t,myFunc:a,listenAfterReply:o=!1,no_response_time:l=3,apiInProgress:i=!1,listenButton:s=!1,session_listen:p=!1}=e;const{finalTranscript:d,interimTranscript:g,resetTranscript:u,listening:m,browserSupportsSpeechRecognition:b,isMicrophoneAvailable:x}=Object(c.useSpeechRecognition)(),[f,h]=Object(n.useState)(""),[y,E]=Object(n.useState)(!0),w=Object(n.useRef)(null),v=Object(n.useRef)(null);Object(n.useEffect)(()=>{(()=>{if(""!==d){if(s)return a(d,{api_body:{}},5),h(e=>`${e} ${d}`.trim()),u(),void h("");if(p){let e=!1;for(let n=0;n<t.length;n++){const{keywords:r,api_body:o}=t[n];for(let l=0;l<r.length;l++){const o=new RegExp(r[l],"i");if(-1!==d.search(o)&&!i)return console.log(`Keyword found: ${r[l]}`),a(d,t[n],1),u(),h(""),void(e=!0)}}e||(h(e=>`${e} ${d}`.trim()),u())}else w.current&&(v.current=w.current.selectionStart),console.log("Recording speech-to-text without keyword triggers"),h(e=>`${e} ${d}`.trim()),u()}})()},[d]);return Object(n.useEffect)(()=>{w.current&&null!==v.current&&(w.current.selectionStart=v.current,w.current.selectionEnd=v.current,v.current=null)},[f]),b?x?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",gap:"10px",marginBottom:"10px"}},r.a.createElement("button",{onClick:()=>{a(f,{api_body:{}},5),u(),h("")},style:{backgroundColor:"rgb(196, 230, 252)",color:"black",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer"}},"Send Transcript"),r.a.createElement("button",{onClick:()=>E(e=>!e),style:{backgroundColor:"white",color:"grey",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer"}},y?"Hide Transcript":"Show Transcript"),r.a.createElement("button",{onClick:()=>{u(),h("")},style:{backgroundColor:"white",color:"grey",border:"none",padding:"10px 20px",borderRadius:"5px",cursor:"pointer"}},"Clear Transcript")),y&&r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"800px",height:"550px",overflowY:"auto",border:"1px solid #ccc",padding:"10px"}},r.a.createElement("span",null,r.a.createElement("strong",null,"Listening:")," ",m?"on":"off"),r.a.createElement("span",null,r.a.createElement("strong",null,"Transcript:")),g&&r.a.createElement("div",{style:{color:"#888",fontStyle:"italic",marginBottom:"8px"}},g),r.a.createElement("textarea",{ref:w,value:f,onChange:e=>{h(e.target.value)},style:{backgroundColor:"rgb(238, 242, 245)",color:"black",width:"100%",height:"550px",border:"1px solid #ccc",padding:"5px",resize:"none"}}))):r.a.createElement("span",null,"Please allow access to the microphone"):r.a.createElement("span",null,"No browser support")};var g=e=>{let{showImage:t,imageSrc:a,largeHeight:n=100,largeWidth:o=100,smallHeight:l=40,smallWidth:i=40}=e;const s=t?n:l,c=t?o:i;return r.a.createElement("div",{className:"p-2",style:{display:"flex",flexDirection:"column",alignItems:"center"}},r.a.createElement("div",{style:{display:"flex",justifyContent:"center",width:"100%"}},a&&(a.toLowerCase().endsWith(".mp4")?r.a.createElement("video",{style:{maxWidth:"100%",borderRadius:"8px",objectFit:"cover"},height:s,width:c,controls:t,autoPlay:!0,loop:!1,muted:!0},r.a.createElement("source",{src:a,type:"video/mp4"}),"Your browser does not support the video tag."):r.a.createElement("img",{src:a,height:s,width:c,style:{maxWidth:"100%",borderRadius:"8px",objectFit:"cover"},alt:"Media Preview"}))))};a(33);let u=[];var m=e=>{var t;const{api:a,kwargs:o={}}=e,{commands:l,height:i,width:c,show_video:m,input_text:b,no_response_time:x,face_recon:f,api_key:h,refresh_ask:y,self_image:E,api_audio:w,client_user:v,force_db_root:k,before_trigger:S,agent_actions:_}=o,[j,O]=Object(n.useState)(o.self_image),[R,C]=Object(n.useState)(o.self_image),[A,L]=Object(n.useState)(""),[T,$]=Object(n.useState)([]),[N,I]=Object(n.useState)(!1),[H,W]=Object(n.useState)(!1),[z,B]=Object(n.useState)(!1),[F,P]=Object(n.useState)(""),[D,M]=Object(n.useState)(!1),[Y,U]=Object(n.useState)(!1),[J,K]=Object(n.useState)(!1),[G,q]=Object(n.useState)(!0),[Q,V]=Object(n.useState)(!1),[X,Z]=Object(n.useState)(!1),[ee,te]=Object(n.useState)(!1),[ae,ne]=Object(n.useState)(o.before_trigger),re=Object(n.useRef)([]),oe=(Object(n.useRef)(!1),Object(n.useRef)(),Object(n.useRef)(),Object(n.useRef)(null)),[le,ie]=Object(n.useState)(!1),[se,ce]=Object(n.useState)("Click and Ask"),[pe,de]=Object(n.useState)("Listening"),[ge,ue]=Object(n.useState)(!1),[me,be]=Object(n.useState)([]),[xe,fe]=Object(n.useState)(0),he=()=>{"undefined"!==typeof window&&fe(window.innerWidth)};Object(n.useEffect)(()=>{he()},[]),Object(n.useEffect)(()=>{E&&ye(E)},[E]);const ye=async e=>{try{const a=await s.a.get(`${w}${e}`,{responseType:"blob"}),n=URL.createObjectURL(a.data);O(n),C(e)}catch(t){console.error("Error fetching image data:",t)}},Ee=()=>{K(!1),p.a.stopListening(),console.log("Stopping Listening, isListening=",J)},we=()=>{K(!0),p.a.startListening({continuous:!0,language:"en-GB"})};Object(n.useEffect)(()=>{J?console.log("Listening has started"):console.log("Listening has stopped")},[J]);const ve=async(e,t,n)=>{L(` (${t.api_body.keyword}) ${e},`);const r=[...u,{user:e}];$([...r]);try{console.log("api call on listen...",t),M(!0),Ee();const e={tigger_type:n,api_key:h,text:r,self_image:R,face_data:re.current,refresh_ask:y,client_user:v,force_db_root:k,session_listen:X,before_trigger_vars:ae,selected_actions:me};console.log("api");const{data:l}=await s.a.post(a,e);if(console.log("data :>> ",l,e),l.self_image&&l.self_image!==R&&ye(l.self_image),$(l.text),u=[...l.text],oe.current&&oe.current.pause(),l.audio_path){const e=`${w}${l.audio_path}`;oe.current=new Audio(e);try{await oe.current.play(),U(!0),de("Speaking"),await new Promise(e=>{oe.current.onended=(()=>{console.log("Audio playback finished."),e()})})}catch(o){console.error("Audio playback error:",o)}finally{oe.current=null,U(!1),de("Listen")}}ce("Click and Ask"),de("Listening"),U(!1),M(!1),I(l.listen_after_reply),console.log("listen after reply",l.listen_after_reply,N),!1!==l.page_direct&&null!==l.page_direct&&(console.log("api has page direct",l.page_direct),window.location.href=l.page_direct),le?ie(!1):1==N?(console.log("API END HIT listenAfterReply==TRUE"),de("Awaiting your Answer please speak")):Q?V(!1):ee&&(console.log("convo mode"),we())}catch(o){console.log("api call on listen failed!",o),M(!1),V(!1)}he(),console.log("ReSize Window")},ke=(null===y||void 0===y?void 0:null===(t=y.color_dict)||void 0===t?void 0:t.background_color_chat)||"transparent",Se=`Chat with ${E.split(".")[0]}`;return console.log("session_listen",X),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"p-2"},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%"}},r.a.createElement("div",null,r.a.createElement(g,{showImage:ge,imageSrc:j,largeHeight:100,largeWidth:100,smallHeight:40,smallWidth:40})),r.a.createElement("div",{style:{flex:ge?1:"100%",overflowY:"auto",maxHeight:"350px"}},G&&r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"350px",height:"350px",overflowY:"auto",border:"1px solid #ccc",padding:"10px"}},T.map((e,t)=>r.a.createElement("div",{key:t,className:"chat-message-container",style:{marginBottom:"5px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}},r.a.createElement("div",{className:"chat-user",style:{backgroundColor:"#e4eafe",textAlign:"right",marginLeft:"auto",padding:"5px"}},v,": ",r.a.createElement("span",null,e.user)),r.a.createElement("div",{className:"chat-response-container",style:{display:"flex",alignItems:"flex-start",backgroundColor:ke,padding:"10px"}},j&&r.a.createElement("div",{className:"chat-image",style:{marginRight:"10px"}},r.a.createElement("img",{src:j,alt:"response",style:{width:"50px"}})),r.a.createElement("div",{className:"chat-response-text",style:{flex:1,wordBreak:"break-word"}},e.resp?r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.resp}}):r.a.createElement("span",{className:"spinner"})))))))),b&&r.a.createElement(r.a.Fragment,null,r.a.createElement("hr",{style:{margin:"3px 0"}}),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{className:"form-control",type:"text",placeholder:Se,value:F,onChange:e=>{P(e.target.value),ie(!0)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",F),ve(F,{api_body:{keyword:""}},4),P(""))}})),r.a.createElement("hr",{style:{margin:"3px 0"}})),r.a.createElement("div",{style:{display:"flex",marginTop:"3px"}},r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:Q?"#478728":"rgb(196, 230, 252)",color:"black",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer",width:"89%"},onClick:()=>{V(!0),J||we(),ce("Please Speak"),console.log("listening button listen click"),console.log(Q)}},se)),r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:ee?"rgb(87, 188, 100)":"rgb(196, 230, 252)",color:"black",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer",width:"89%"},onClick:()=>{console.log("listening?",J),J?(console.log("Stopping listening..."),te(!1),Ee()):(console.log("Starting to listen..."),te(!0),we())}},ee?"End Conversation":"Start Conversation"),J&&r.a.createElement("div",{style:{width:"89%",height:"10px",backgroundImage:"linear-gradient(90deg, green, transparent 50%, green)",animation:"flashLine 1s infinite",marginTop:"5px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},pe)),Y&&r.a.createElement("div",{style:{height:"10px",background:"linear-gradient(to right, blue, transparent, purple)",animation:"waveAnimation 1s infinite",marginTop:"5px",borderRadius:"10px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},"Speaking"))),r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:X?"rgb(250, 234, 131)":"rgb(196, 230, 252)",color:"black",border:"1px solid #2980b9",borderRadius:"1px",cursor:"pointer",width:"89%"},onClick:()=>{Z(!X)}},X?"Stop Session":"Start Session"),X&&r.a.createElement("div",{style:{width:"89%",height:"10px",backgroundImage:"linear-gradient(90deg, orange, transparent 50%, orange)",animation:"flashLine 1s infinite",marginTop:"5px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},"Session Started")))),Array.isArray(_)&&_.length>0&&r.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",marginTop:"8px",gap:"6px"}},_.map((e,t)=>{const a=me.includes(e);return r.a.createElement("button",{key:t,onClick:()=>{be(a?me.filter(t=>t!==e):[...me,e])},style:{fontSize:"12px",padding:"5px 10px",backgroundColor:a?"#1abc9c":"#ecf0f1",color:a?"white":"black",border:"1px solid #bdc3c7",borderRadius:"4px",cursor:"pointer"}},e)})),r.a.createElement("div",{className:"p-2",style:{marginBottom:"15px"}},r.a.createElement(d,{commands:l,myFunc:ve,listenAfterReply:N,no_response_time:x,apiInProgress:D,listenButton:Q,session_listen:X,listening:J}))))};var b=Object(i.b)(e=>{const{api:t,kwargs:a}=e.args;return Object(n.useEffect)(()=>i.a.setFrameHeight()),r.a.createElement(r.a.Fragment,null,r.a.createElement(m,{api:t,kwargs:a}))}),x=a(54),f=a(20),h=a(52),y=a(42);const E=new x.a;l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(f.a,{value:E},r.a.createElement(h.a,{theme:y.a},r.a.createElement(b,null)))),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.0f22dcdf.chunk.js.map