(this.webpackJsonpstreamlit_custom_voice_gpt=this.webpackJsonpstreamlit_custom_voice_gpt||[]).push([[0],{20:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=20},25:function(e,t,a){e.exports=a(44)},44:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),r=a(21),i=a.n(r),l=a(10),s=a(55),c=a(7),d=a.n(c);var p=e=>{let{commands:t,myFunc:a,listenAfterReply:r=!1,no_response_time:i=3,apiInProgress:l=!1,listenButton:s=!1,session_listen:d=!1}=e;const[p,g]=Object(n.useState)(!0),[m,u]=Object(n.useState)(!0),{finalTranscript:f,resetTranscript:b,listening:h,browserSupportsSpeechRecognition:x,isMicrophoneAvailable:y}=Object(c.useSpeechRecognition)({transcribing:p,clearTranscriptOnListen:m}),[E,w]=Object(n.useState)(!0);return Object(n.useEffect)(()=>{if(""!==f){if(console.log("Got final result:",f),console.log("listening?",h),console.log("listenAfterReply:",r),d&&f.split(" ").length>5e5){console.log("Transcript exceeds X words");for(let e=0;e<t.length;e++)a(f,t[e],6);return void b()}if(!d&&f.split(" ").length>1e4)return console.log("Transcript exceeds 10000 words. Clearing."),void b();const e=setTimeout(()=>{for(let e=0;e<t.length;e++){const{keywords:n,api_body:o}=t[e];for(let i=0;i<n.length;i++){const o=new RegExp(n[i],"i"),c=-1!==f.search(o);if((c||r||s)&&!l)return r?a(f,{api_body:{keyword:""}},3):c?a(f,t[e],1):s&&a(f,t[e],5),void b()}}console.log("Waiting for a keyword")},1e3*i);return()=>clearTimeout(e)}},[f,h,r,t,i,b,l,s]),x?y?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{height:"20px"}})," ",E&&o.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"200px",overflowY:"auto",border:"1px solid #ccc",padding:"10px"}},o.a.createElement("span",null,"You said: ",f),o.a.createElement("span",null,"Listening: ",h?"on":"off")),o.a.createElement("button",{onClick:()=>{console.log("set showTranscript",E),w(!E)},style:{marginTop:"10px"}},E?"Hide Transcript":"Show Transcript"),o.a.createElement("button",{onClick:()=>{console.log("clear transcript"),b()},style:{marginTop:"10px"}},"Clear Transscript")):o.a.createElement("span",null,"Please allow access to the microphone"):o.a.createElement("span",null,"No browser support")};var g=e=>{let{showImage:t,imageSrc:a,largeHeight:n=100,largeWidth:r=100,smallHeight:i=40,smallWidth:l=40}=e;const s=t?n:i,c=t?r:l;return o.a.createElement("div",{className:"p-2",style:{display:"flex",flexDirection:"column",alignItems:"center"}},o.a.createElement("div",{style:{display:"flex",justifyContent:"center",width:"100%"}},a&&(a.toLowerCase().endsWith(".mp4")?o.a.createElement("video",{style:{maxWidth:"100%",borderRadius:"8px",objectFit:"cover"},height:s,width:c,controls:t,autoPlay:!0,loop:!1,muted:!0},o.a.createElement("source",{src:a,type:"video/mp4"}),"Your browser does not support the video tag."):o.a.createElement("img",{src:a,height:s,width:c,style:{maxWidth:"100%",borderRadius:"8px",objectFit:"cover"},alt:"Media Preview"}))))},m=a(3);a(37);let u=[];var f=e=>{var t;const{api:a,kwargs:r={}}=e,{commands:i,height:l,width:c,show_video:f,input_text:b,no_response_time:h,face_recon:x,api_key:y,refresh_ask:E,self_image:w,api_audio:v,client_user:_,force_db_root:S,before_trigger:k}=r,[O,j]=Object(n.useState)(r.self_image),[R,T]=Object(n.useState)(r.self_image),[C,A]=Object(n.useState)(""),[L,N]=Object(n.useState)([]),[F,I]=Object(n.useState)(!1),[D,H]=Object(n.useState)(!1),[U,W]=Object(n.useState)(!1),[P,z]=Object(n.useState)(""),[B,M]=Object(n.useState)(!1),[Y,G]=Object(n.useState)(!1),[J,V]=Object(n.useState)(!1),[K,X]=Object(n.useState)(!0),[q,Q]=Object(n.useState)(!1),[Z,$]=Object(n.useState)(!1),[ee,te]=Object(n.useState)(r.before_trigger),ae=Object(n.useRef)([]),ne=(Object(n.useRef)(!1),Object(n.useRef)(),Object(n.useRef)(),Object(n.useRef)(null)),[oe,re]=Object(n.useState)(!1),[ie,le]=Object(n.useState)("Click and Ask"),[se,ce]=Object(n.useState)("Listening"),[de,pe]=Object(n.useState)(!1),[ge,me]=Object(n.useState)(0),ue=()=>{"undefined"!==typeof window&&me(window.innerWidth)};Object(n.useEffect)(()=>{ue()},[]),Object(n.useEffect)(()=>{w&&fe(w)},[w]);const fe=async e=>{try{const t=await s.a.get("".concat(v).concat(e),{responseType:"blob"}),a=URL.createObjectURL(t.data);j(a),T(e)}catch(t){console.error("Error fetching image data:",t)}},be=()=>{V(!1),d.a.stopListening(),console.log("Stopping Listening, isListening=",J)},he=()=>{V(!0),d.a.startListening({continuous:!0,language:"en-GB"})};Object(n.useEffect)(()=>{J?console.log("Listening has started"):console.log("Listening has stopped")},[J]);Object(n.useEffect)(()=>{(async()=>{Promise.all([m.f.tinyFaceDetector.loadFromUri("./models"),m.f.faceLandmark68Net.loadFromUri("./models"),m.f.faceRecognitionNet.loadFromUri("./models"),m.f.faceExpressionNet.loadFromUri("./models"),m.f.ageGenderNet.loadFromUri("./models")]).then(()=>H(!0))})();const e=setInterval(()=>{},3e3);return()=>clearInterval(e)},[]);const xe=async(e,t,n)=>{A(" (".concat(t.api_body.keyword,") ").concat(e,","));const o=[...u,{user:e}];N([...o]);try{console.log("api call on listen...",t),M(!0),be();const e={tigger_type:n,api_key:y,text:o,self_image:R,face_data:ae.current,refresh_ask:E,client_user:_,force_db_root:S,session_listen:Z,before_trigger_vars:ee};console.log("api");const{data:i}=await s.a.post(a,e);if(console.log("data :>> ",i,e),i.self_image&&i.self_image!==R&&fe(i.self_image),N(i.text),u=[...i.text],ne.current&&ne.current.pause(),i.audio_path){const e="".concat(v).concat(i.audio_path);ne.current=new Audio(e);try{await ne.current.play(),G(!0),ce("Speaking"),await new Promise(e=>{ne.current.onended=()=>{console.log("Audio playback finished."),e()}})}catch(r){console.error("Audio playback error:",r)}finally{ne.current=null,G(!1),ce("Listen")}}le("Click and Ask"),ce("Listening"),G(!1),M(!1),console.log("Audio ENDED MOVE TO SET VARS ."),I(i.listen_after_reply),console.log("listen after reply",i.listen_after_reply,F),!1!==i.page_direct&&null!==i.page_direct&&(console.log("api has page direct",i.page_direct),window.location.href=i.page_direct),oe?re(!1):1==F?(console.log("API END HIT listen after replyTRUE"),ce("Awaiting your Answer please speak")):q&&Q(!1)}catch(r){console.log("api call on listen failed!",r),M(!1),Q(!1)}ue(),console.log("ReSize Window")},ye=(null===(t=E.color_dict)||void 0===t?void 0:t.background_color_chat)||"transparent",Ee=w.split(".")[0],we="Chat with ".concat(Ee);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"p-2"},o.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%"}},o.a.createElement("div",null,o.a.createElement(g,{showImage:de,imageSrc:O,largeHeight:100,largeWidth:100,smallHeight:40,smallWidth:40})),o.a.createElement("div",{style:{flex:de?1:"100%",overflowY:"auto",maxHeight:"400px"}},K&&o.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"400px",height:"400px",overflowY:"auto",border:"1px solid #ccc",padding:"10px"}},L.map((e,t)=>o.a.createElement("div",{key:t,className:"chat-message-container",style:{marginBottom:"5px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}},o.a.createElement("div",{className:"chat-user",style:{backgroundColor:"#f2f2f2",textAlign:"right",marginLeft:"auto",padding:"5px"}},_,": ",o.a.createElement("span",null,e.user)),o.a.createElement("div",{className:"chat-response-container",style:{display:"flex",alignItems:"flex-start",backgroundColor:ye,padding:"10px"}},O&&o.a.createElement("div",{className:"chat-image",style:{marginRight:"10px"}},o.a.createElement("img",{src:O,alt:"response",style:{width:"50px"}})),o.a.createElement("div",{className:"chat-response-text",style:{flex:1,wordBreak:"break-word"}},e.resp||"thinking..."))))))),b&&o.a.createElement(o.a.Fragment,null,o.a.createElement("hr",{style:{margin:"20px 0"}}),o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{className:"form-control",type:"text",placeholder:we,value:P,onChange:e=>{z(e.target.value),re(!0)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",P),xe(P,{api_body:{keyword:""}},4),z(""))}})),o.a.createElement("hr",{style:{margin:"20px 0"}})),o.a.createElement("div",{style:{display:"flex",marginTop:"10px"}},o.a.createElement("div",{style:{flex:1,textAlign:"center"}},o.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:"#3498db",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer",width:"100%"},onClick:()=>{Q(!0),J||he(),le("Please Speak"),console.log("listening button listen click"),console.log(q)}},ie),J&&o.a.createElement("div",{style:{width:"100%",height:"10px",backgroundImage:"linear-gradient(90deg, green, transparent 50%, green)",animation:"flashLine 1s infinite",marginTop:"5px"}},o.a.createElement("div",{style:{fontSize:"12px",color:"black"}},se))),o.a.createElement("div",{style:{flex:1,textAlign:"center"}},o.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:"#2980b9",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer"},onClick:()=>{console.log("listening?",J),J?(console.log("Stopping listening..."),be()):(console.log("Starting to listen..."),he())}},"Conversational Mode"),Y&&o.a.createElement("div",{style:{height:"10px",background:"linear-gradient(to right, blue, transparent, purple)",animation:"waveAnimation 1s infinite",marginTop:"5px",borderRadius:"10px"}},o.a.createElement("div",{style:{fontSize:"12px",color:"black"}},"Speaking"))),o.a.createElement("div",{style:{flex:1,textAlign:"center"}},o.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:"#2980b9",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer"},onClick:()=>{$(!Z)}},Z?"Stop Session":"Start Session"),Z&&o.a.createElement("div",{style:{width:"89%",height:"10px",backgroundImage:"linear-gradient(90deg, orange, transparent 50%, orange)",animation:"flashLine 1s infinite",marginTop:"5px"}},o.a.createElement("div",{style:{fontSize:"12px",color:"black"}},"Session Started"))),o.a.createElement("div",{style:{flex:1,textAlign:"center"}},o.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:"#7f8c8d",color:"white",border:"1px solid #7f8c8d",borderRadius:"4px",cursor:"pointer"},onClick:be},J?"Stop Listening":""))),o.a.createElement("div",{className:"p-2",style:{marginBottom:"15px"}},o.a.createElement(p,{commands:i,myFunc:xe,listenAfterReply:F,no_response_time:h,apiInProgress:B,listenButton:q,session_listen:Z,listening:J}))))};var b=Object(l.b)(e=>{const{api:t,kwargs:a}=e.args;return Object(n.useEffect)(()=>l.a.setFrameHeight()),o.a.createElement(o.a.Fragment,null,o.a.createElement(f,{api:t,kwargs:a}))}),h=a(56),x=a(24),y=a(54),E=a(45);const w=new h.a;i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(x.a,{value:w},o.a.createElement(y.a,{theme:E.a},o.a.createElement(b,null)))),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.08143c01.chunk.js.map