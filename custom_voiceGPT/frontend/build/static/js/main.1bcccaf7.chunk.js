(this.webpackJsonpstreamlit_custom_voice_gpt=this.webpackJsonpstreamlit_custom_voice_gpt||[]).push([[0],{20:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=20},25:function(e,t,n){e.exports=n(43)},43:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(21),c=n.n(o),s=n(8),l=n(54),i=n(5),u=n.n(i);var d=e=>{let{commands:t,myFunc:n,listenAfterReply:o=!1,noResponseTime:c=1,show_conversation:s=!0,apiInProgress:l=!1}=e;const[u,d]=Object(a.useState)(!0),[p,m]=Object(a.useState)(!0),{finalTranscript:g,resetTranscript:f,listening:h,browserSupportsSpeechRecognition:b,isMicrophoneAvailable:y}=Object(i.useSpeechRecognition)({transcribing:u,clearTranscriptOnListen:p}),[E,w]=Object(a.useState)("");return Object(a.useEffect)(()=>{if(""!==g){if(console.log("Got final result:",g),console.log("listenAfterReply:",o),g.split(" ").length>89)return console.log("Transcript exceeds 89 words. Clearing."),void f();w(g);const e=setTimeout(()=>{for(let e=0;e<t.length;e++){const{keywords:a,api_body:r}=t[e];for(let c=0;c<a.length;c++){const r=new RegExp(a[c],"i"),s=-1!==g.search(r);if(console.log("listenAfterReply:",o),(s||o)&&!l)return o?n(g,{api_body:{keyword:""}},3):s&&n(g,t[e],1),void f()}}console.log("Waiting for a keyword or API is in progress")},1e3*c);return()=>clearTimeout(e)}},[g,o,t,c,f,l]),b?y?r.a.createElement(r.a.Fragment,null,s&&r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.a.createElement("span",null,"You said: ",E),r.a.createElement("span",null,"Listening: ",h?"on":"off"),r.a.createElement("span",null,"Clear Transcript On Listen: ",p?"on":"off"))):r.a.createElement("span",null,"Please allow access to the microphone"):r.a.createElement("span",null,"No browser support")},p=n(3);let m=[],g=!1;var f=e=>{const{api:t,kwargs:n={}}=e,{commands:o,height:c,width:i,show_conversation:f,show_video:h,input_text:b,no_response_time:y,face_recon:E,api_key:w,refresh_ask:v}=n,[_,O]=Object(a.useState)(n.self_image),[k,x]=Object(a.useState)(""),[j,F]=Object(a.useState)([]),[S,R]=Object(a.useState)(!1),[C,L]=Object(a.useState)(!1),[N,T]=Object(a.useState)(!1),[A,I]=Object(a.useState)(""),[D,U]=Object(a.useState)(!1),P=Object(a.useRef)([]),M=Object(a.useRef)(!1),G=Object(a.useRef)(),H=Object(a.useRef)(),W=Object(a.useRef)(null),[B,Y]=Object(a.useState)(!0),z=()=>{u.a.browserSupportsContinuousListening()||K()},J=async(e,n,a)=>{x(" (".concat(n.api_body.keyword,") ").concat(e,","));const r=[...m,{user:e}];F([...r]);try{console.log("api call on listen...",n),U(!0);const e={tigger_type:a,api_key:w,text:r,self_image:_,face_data:P.current,refresh_ask:v};console.log("api");const{data:o}=await l.a.post(t,e);console.log("data :>> ",o,e),o.self_image&&O(o.self_image),W.current&&W.current.pause(),q(),W.current=new Audio(o.audio_path),W.current.play(),W.current.onended=()=>{console.log("Audio playback finished."),Q(),R(o.listen_after_reply),console.log("listen after reply",o.listen_after_reply),F(o.text),m=[...o.text],!0===o.page_direct&&(console.log("api has page direct",o.page_direct),window.location.reload()),U(!1)}}catch(o){console.log("api call on listen failed!",o),U(!1)}},K=()=>{u.a.startListening({continuous:!0,language:"en-GB"}),Y(!0)},q=()=>{u.a.stopListening()},Q=()=>u.a.startListening({continuous:!0,language:"en-GB"});return Object(a.useEffect)(()=>{s.a.setFrameHeight();const e=setInterval(z,6e4);return()=>{clearInterval(e)}},[]),Object(a.useEffect)(()=>{(async()=>{Promise.all([p.f.tinyFaceDetector.loadFromUri("./models"),p.f.faceLandmark68Net.loadFromUri("./models"),p.f.faceRecognitionNet.loadFromUri("./models"),p.f.faceExpressionNet.loadFromUri("./models"),p.f.ageGenderNet.loadFromUri("./models")]).then(()=>L(!0))})();const e=setInterval(()=>{console.log("faceData.current :>> ",P.current)},3e3);return()=>clearInterval(e)},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"p-2"},r.a.createElement("div",null,_&&_.toLowerCase().endsWith(".mp4")?r.a.createElement("video",{height:c||100,width:i||100,controls:!0,autoPlay:!0,loop:!1,muted:!0},r.a.createElement("source",{src:_,type:"video/mp4"}),"Your browser does not support the video tag."):r.a.createElement("img",{src:_,height:c||100,width:i||100})),r.a.createElement("div",{className:"p-2"},r.a.createElement(d,{commands:o,myFunc:J,listenAfterReply:S,noResponseTime:y,show_conversation:f,apiInProgress:D})),r.a.createElement("div",{className:"form-group"},r.a.createElement("button",{className:"btn btn-primary",onClick:Q},"Listen continuously")),b&&r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{className:"form-control",type:"text",placeholder:"Chat with Hoots",value:A,onChange:e=>{const{value:t}=e.target;I(t)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",A),J(A,{api_body:{keyword:""}},4),I(""))}})),!0===f&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null," You: ",k),j.map((e,t)=>r.a.createElement("div",{key:t},r.a.createElement("div",null,"-user: ",e.user),r.a.createElement("div",null,"-resp: ",e.resp?e.resp:"thinking..."))))),r.a.createElement("div",null),r.a.createElement("div",null,E&&r.a.createElement("div",{style:{textAlign:"center",padding:"10px"}},N&&C?r.a.createElement("button",{onClick:()=>{G.current.pause(),G.current.srcObject.getTracks()[0].stop(),T(!1)},style:{cursor:"pointer",backgroundColor:"green",color:"white",padding:"15px",fontSize:"25px",border:"none",borderRadius:"10px"}},"Close Webcam"):r.a.createElement("button",{onClick:()=>{T(!0),navigator.mediaDevices.getUserMedia({video:{width:300}}).then(e=>{let t=G.current;t.srcObject=e,t.play()}).catch(e=>{console.error("error:",e)})},style:{cursor:"pointer",backgroundColor:"green",color:"white",padding:"15px",fontSize:"25px",border:"none",borderRadius:"10px"}},"Open Webcam")),N?C?r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex",justifyContent:"center",padding:"10px",position:h?"":"absolute",opacity:h?1:.3}},r.a.createElement("video",{ref:G,height:480,width:640,onPlay:()=>{setInterval(async()=>{if(H&&H.current){H.current.innerHTML=p.b(G.current);const e={width:640,height:480};p.e(H.current,e);const t=await p.c(G.current,new p.a).withFaceLandmarks().withFaceExpressions(),a=p.g(t,e);if(a.length>0?(P.current=a,!M.current&&E&&(J("",{api_body:{keyword:""}},2),M.current=!0)):setTimeout(()=>{P.current=[]},1e3),a.length>0&&!g&&(g=!0,n.hello_audio)){new Audio(n.hello_audio).play()}H&&H.current&&H.current.getContext("2d").clearRect(0,0,640,480),H&&H.current&&p.d.drawDetections(H.current,a),H&&H.current&&p.d.drawFaceLandmarks(H.current,a),H&&H.current&&p.d.drawFaceExpressions(H.current,a)}},300)},style:{borderRadius:"10px"}}),r.a.createElement("canvas",{ref:H,style:{position:"absolute"}}))):r.a.createElement("div",null,"loading..."):r.a.createElement(r.a.Fragment,null)))};var h=Object(s.b)(e=>{const{api:t,kwargs:n}=e.args;return Object(a.useEffect)(()=>s.a.setFrameHeight()),r.a.createElement(r.a.Fragment,null,r.a.createElement(f,{api:t,kwargs:n}))}),b=n(55),y=n(24),E=n(53),w=n(44);const v=new b.a;c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(y.a,{value:v},r.a.createElement(E.a,{theme:w.a},r.a.createElement(h,null)))),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.1bcccaf7.chunk.js.map