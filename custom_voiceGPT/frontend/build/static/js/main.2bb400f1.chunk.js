(this.webpackJsonpstreamlit_custom_voice_gpt=this.webpackJsonpstreamlit_custom_voice_gpt||[]).push([[0],{21:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=21},26:function(e,t,a){e.exports=a(44)},44:function(e,t,a){"use strict";a.r(t);var o=a(1),r=a.n(o),n=a(22),s=a.n(n),l=a(8),c=a(55),d=a(5),p=a.n(d);var u=e=>{let{commands:t,myFunc:a,listenAfterReply:n=!1,no_response_time:s=3,show_conversation:l=!0,apiInProgress:c=!1,listenButton:p=!1,session_listen:u=!1}=e;const[g,m]=Object(o.useState)(!0),[f,b]=Object(o.useState)(!0),{finalTranscript:h,resetTranscript:_,listening:E,browserSupportsSpeechRecognition:x,isMicrophoneAvailable:y}=Object(d.useSpeechRecognition)({transcribing:g,clearTranscriptOnListen:f}),[w,v]=Object(o.useState)("");return Object(o.useEffect)(()=>{if(""!==h){if(console.log("Got final result:",h),console.log("listening?",E),console.log("listenAfterReply:",n),u&&h.split(" ").length>5e5)return console.log("Transcript exceeds X words"),a(h,t[i],6),void _();if(0==u&&h.split(" ").length>1e4)return console.log("Transcript exceeds 89 words. Clearing You really should call func-api to save ."),void _();v(h);const e=setTimeout(()=>{for(let e=0;e<t.length;e++){const{keywords:o,api_body:r}=t[e];for(let s=0;s<o.length;s++){const r=new RegExp(o[s],"i"),l=-1!==h.search(r);if((l||n||p)&&!c)return n?a(h,{api_body:{keyword:""}},3):l?a(h,t[e],1):p&&a(h,t[e],5),void _()}}console.log("Waiting for a keyword or API is in progress")},1e3*s);return()=>clearTimeout(e)}},[h,n,t,s,_,c,p]),x?y?r.a.createElement(r.a.Fragment,null,l&&r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"200px",overflowY:"auto",border:"1px solid #ccc",padding:"10px"}},r.a.createElement("span",null,"You said: ",w),r.a.createElement("span",null,"Listening: ",E?"on":"off"))):r.a.createElement("span",null,"Please allow access to the microphone"):r.a.createElement("span",null,"No browser support")},g=a(3),m=a(13),f=a.n(m);let b=[];var h=e=>{var t;const{api:a,kwargs:n={}}=e,{commands:s,height:i,width:d,show_conversation:m,show_video:h,input_text:_,no_response_time:E,face_recon:x,api_key:y,refresh_ask:w,self_image:v,api_audio:S,client_user:O,force_db_root:k,before_trigger:j}=n,[R,N]=Object(o.useState)(n.self_image),[L,C]=Object(o.useState)(n.self_image),[I,T]=Object(o.useState)(""),[F,A]=Object(o.useState)([]),[P,H]=Object(o.useState)(!1),[U,D]=Object(o.useState)(!1),[z,B]=Object(o.useState)(!1),[M,Y]=Object(o.useState)(""),[G,V]=Object(o.useState)(!1),[W,J]=Object(o.useState)(!1),[K,X]=Object(o.useState)(!1),[q,Q]=Object(o.useState)(!1),[Z,$]=Object(o.useState)(n.before_trigger),ee=Object(o.useRef)([]),te=(Object(o.useRef)(!1),Object(o.useRef)(),Object(o.useRef)(),Object(o.useRef)(null)),[ae,oe]=Object(o.useState)(!1),[re,ne]=Object(o.useState)(!1),[se,le]=Object(o.useState)("Click and Ask"),[ie,ce]=Object(o.useState)("Listening"),[de,pe]=Object(o.useState)(!1);Object(o.useEffect)(()=>{v&&ue(v)},[v]);const ue=async e=>{try{const t=await c.a.get("".concat(S).concat(e),{responseType:"blob"}),a=URL.createObjectURL(t.data);N(a),C(e)}catch(error){console.error("Error fetching image data:",error)}};Object(o.useEffect)(()=>{l.a.setFrameHeight();const e=setInterval(()=>{p.a.browserSupportsContinuousListening()||(console.log("LISTEN STOPPED TURNING BACK ON",error),ge())},6e4);return()=>{clearInterval(e)}},[]);const ge=()=>{p.a.startListening({continuous:!0,language:"en-GB"}),oe(!0)};Object(o.useEffect)(()=>{(async()=>{Promise.all([g.f.tinyFaceDetector.loadFromUri("./models"),g.f.faceLandmark68Net.loadFromUri("./models"),g.f.faceRecognitionNet.loadFromUri("./models"),g.f.faceExpressionNet.loadFromUri("./models"),g.f.ageGenderNet.loadFromUri("./models")]).then(()=>D(!0))})();const e=setInterval(()=>{},3e3);return()=>clearInterval(e)},[]);const me=async(e,t,o)=>{T(" (".concat(t.api_body.keyword,") ").concat(e,","));const r=[...b,{user:e}];A([...r]);try{console.log("api call on listen...",t),V(!0),p.a.stopListening(),oe(!1),console.log("Stopping Listening, isListening=",ae);const e={tigger_type:o,api_key:y,text:r,self_image:L,face_data:ee.current,refresh_ask:w,client_user:O,force_db_root:k,session_listen:q,before_trigger_vars:Z};console.log("api");const{data:n}=await c.a.post(a,e);if(console.log("data :>> ",n,e),n.self_image&&n.self_image!==L&&ue(n.self_image),A(n.text),b=[...n.text],te.current&&te.current.pause(),n.audio_path){const e="".concat(S).concat(n.audio_path);te.current=new Audio(e);try{await te.current.play(),J(!0),ce("Speaking"),await new Promise(e=>{te.current.onended=()=>{console.log("Audio playback finished."),e()}})}catch(error){console.error("Audio playback error:",error)}finally{te.current=null,J(!1),ce("Listen")}}le("Click and Ask"),ce("Listening"),J(!1),V(!1),console.log("Audio ENDED MOVE TO SET VARS ."),H(n.listen_after_reply),console.log("listen after reply",n.listen_after_reply),!1!==n.page_direct&&null!==n.page_direct&&(console.log("api has page direct",n.page_direct),window.location.href=n.page_direct),1!=P||K||re?K?X(!1):re?ne(!1):(ge(),ce("listeing for key word")):(ge(),ce("Awaiting your Answer please speak")),console.log("listing end",ae)}catch(error){console.log("api call on listen failed!",error),V(!1),X(!1)}};Object(o.useEffect)(()=>{const e=()=>{window.resizeBy(0,1)};return window.addEventListener("RESPONSE_FINISH_EVENT",e),()=>{window.removeEventListener("RESPONSE_FINISH_EVENT",e)}},[]);const fe=(null===(t=w.color_dict)||void 0===t?void 0:t.background_color_chat)||"transparent",be=v.split(".")[0],he="Chat with ".concat(be);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"p-2"},r.a.createElement("div",{style:{display:"flex",flexDirection:"row",width:"100%"}},de&&r.a.createElement("div",{style:{flex:1}},R&&(R.toLowerCase().endsWith(".mp4")?r.a.createElement("video",{style:{maxWidth:"100%"},height:i||100,width:d||100,controls:!0,autoPlay:!0,loop:!1,muted:!0},r.a.createElement("source",{src:R,type:"video/mp4"}),"Your browser does not support the video tag."):r.a.createElement("img",{src:R,height:i||100,width:d||100,style:{maxWidth:"100%"}}))),r.a.createElement("div",{style:{flex:de?1:"100%",overflowY:"auto",maxHeight:"400px"}},m&&r.a.createElement("div",{style:{border:"2px solid #2980b9",borderRadius:"6px",overflowY:"auto",maxHeight:"400px",padding:"10px"}},F.map((e,t)=>r.a.createElement("div",{key:t,style:{marginBottom:"5px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}},r.a.createElement("div",{className:"chat-user",style:{backgroundColor:"transparent"}},O,": ",r.a.createElement("span",{dangerouslySetInnerHTML:{__html:f.a.sanitize(e.user)}})),r.a.createElement("div",{className:"chat-resp",style:{display:"flex",alignItems:"center",backgroundColor:fe}},r.a.createElement("div",{className:"chat-image",style:{marginRight:"10px"}},r.a.createElement("img",{src:R,alt:"response",style:{width:"50px"}})," "),r.a.createElement("span",null,r.a.createElement("span",{dangerouslySetInnerHTML:{__html:f.a.sanitize(e.resp||"thinking...")}})))))))),_&&r.a.createElement(r.a.Fragment,null,r.a.createElement("hr",{style:{margin:"20px 0"}}),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{className:"form-control",type:"text",placeholder:he,value:M,onChange:e=>{Y(e.target.value),ne(!0)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",M),me(M,{api_body:{keyword:""}},4),Y(""))}})),r.a.createElement("hr",{style:{margin:"20px 0"}})),r.a.createElement("div",{style:{display:"flex",marginTop:"10px"}},r.a.createElement("button",{style:{flex:1,fontSize:"12px",padding:"5px",marginRight:"5px",backgroundColor:"#3498db",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer"},onClick:()=>{X(!0),ge(),le("Please Speak"),console.log("listening button listen click"),console.log(K)}},se),r.a.createElement("button",{style:{flex:1,fontSize:"12px",padding:"5px",marginLeft:"5px",backgroundColor:"#2980b9",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer"},onClick:ge},"Conversational Mode"),r.a.createElement("button",{style:{flex:1,fontSize:"12px",padding:"5px",marginLeft:"5px",backgroundColor:"#2980b9",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer"},onClick:()=>{Q(!q)}},"Start A Session"),r.a.createElement("button",{style:{flex:1,fontSize:"12px",padding:"5px",marginLeft:"5px",backgroundColor:"#7f8c8d",color:"white",border:"1px solid #7f8c8d",borderRadius:"4px",cursor:"pointer"},onClick:()=>{pe(e=>!e)}},de?"Hide Image":"Show Image")),r.a.createElement("div",{className:"p-2"},r.a.createElement(u,{commands:s,myFunc:me,listenAfterReply:P,no_response_time:E,show_conversation:m,apiInProgress:G,listenButton:K,session_listen:q}))))};var _=Object(l.b)(e=>{const{api:t,kwargs:a}=e.args;return Object(o.useEffect)(()=>l.a.setFrameHeight()),r.a.createElement(r.a.Fragment,null,r.a.createElement(h,{api:t,kwargs:a}))}),E=a(56),x=a(25),y=a(54),w=a(45);const v=new E.a;s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(x.a,{value:v},r.a.createElement(y.a,{theme:w.a},r.a.createElement(_,null)))),document.getElementById("root"))}},[[26,1,2]]]);
//# sourceMappingURL=main.2bb400f1.chunk.js.map