(this.webpackJsonpstreamlit_custom_voice_gpt=this.webpackJsonpstreamlit_custom_voice_gpt||[]).push([[0],{21:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=21},26:function(e,t,n){e.exports=n(44)},44:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(22),s=n.n(r),l=n(8),c=n(55),p=n(5),d=n.n(p);var g=e=>{let{commands:t,myFunc:n,listenAfterReply:r=!1,no_response_time:s=3,show_conversation:l=!0,apiInProgress:c=!1,listenButton:d=!1,session_listen:g=!1}=e;const[u,m]=Object(a.useState)(!0),[f,b]=Object(a.useState)(!0),{finalTranscript:h,resetTranscript:E,listening:y,browserSupportsSpeechRecognition:_,isMicrophoneAvailable:v}=Object(p.useSpeechRecognition)({transcribing:u,clearTranscriptOnListen:f}),[w,x]=Object(a.useState)("");return Object(a.useEffect)(()=>{if(""!==h){if(console.log("Got final result:",h),console.log("listening?",y),console.log("listenAfterReply:",r),g&&h.split(" ").length>5e5)return console.log("Transcript exceeds X words"),n(h,t[i],6),void E();if(0==g&&h.split(" ").length>1e4)return console.log("Transcript exceeds 89 words. Clearing You really should call func-api to save ."),void E();x(h);const e=setTimeout(()=>{for(let e=0;e<t.length;e++){const{keywords:a,api_body:o}=t[e];for(let i=0;i<a.length;i++){const o=new RegExp(a[i],"i"),s=-1!==h.search(o);if((s||r||d)&&!c)return r?n(h,{api_body:{keyword:""}},3):s?n(h,t[e],1):d&&n(h,t[e],5),void E()}}console.log("Waiting for a keyword or API is in progress")},1e3*s);return()=>clearTimeout(e)}},[h,r,t,s,E,c,d]),_?v?o.a.createElement(o.a.Fragment,null,l&&o.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"200px",overflowY:"auto",border:"1px solid #ccc",padding:"10px"}},o.a.createElement("span",null,"You said: ",w),o.a.createElement("span",null,"Listening: ",y?"on":"off"))):o.a.createElement("span",null,"Please allow access to the microphone"):o.a.createElement("span",null,"No browser support")},u=n(3),m=n(13),f=n.n(m);let b=[];var h=e=>{const{api:t,kwargs:n={}}=e,{commands:r,height:i,width:s,show_conversation:p,show_video:m,input_text:h,no_response_time:E,face_recon:y,api_key:_,refresh_ask:v,self_image:w,api_audio:x,client_user:S,force_db_root:k,before_trigger:O}=n,[j,L]=Object(a.useState)(n.self_image),[N,R]=Object(a.useState)(n.self_image),[I,T]=Object(a.useState)(""),[C,F]=Object(a.useState)([]),[A,P]=Object(a.useState)(!1),[U,D]=Object(a.useState)(!1),[M,H]=Object(a.useState)(!1),[z,B]=Object(a.useState)(""),[Y,X]=Object(a.useState)(!1),[G,V]=Object(a.useState)(!1),[J,K]=Object(a.useState)(!1),[W,q]=Object(a.useState)(!1),[Q,Z]=Object(a.useState)(n.before_trigger),$=Object(a.useRef)([]),ee=(Object(a.useRef)(!1),Object(a.useRef)(),Object(a.useRef)(),Object(a.useRef)(null)),[te,ne]=Object(a.useState)(!1),[ae,oe]=Object(a.useState)(!1),[re,ie]=Object(a.useState)("Click and Ask"),[se,le]=Object(a.useState)("Listening");Object(a.useEffect)(()=>{w&&ce(w)},[w]);const ce=async e=>{try{const t=await c.a.get("".concat(x).concat(e),{responseType:"blob"}),n=URL.createObjectURL(t.data);L(n),R(e)}catch(error){console.error("Error fetching image data:",error)}};Object(a.useEffect)(()=>{l.a.setFrameHeight();const e=setInterval(()=>{d.a.browserSupportsContinuousListening()||(console.log("LISTEN STOPPED TURNING BACK ON",error),pe())},6e4);return()=>{clearInterval(e)}},[]);const pe=()=>{d.a.startListening({continuous:!0,language:"en-GB"}),ne(!0)};Object(a.useEffect)(()=>{(async()=>{Promise.all([u.f.tinyFaceDetector.loadFromUri("./models"),u.f.faceLandmark68Net.loadFromUri("./models"),u.f.faceRecognitionNet.loadFromUri("./models"),u.f.faceExpressionNet.loadFromUri("./models"),u.f.ageGenderNet.loadFromUri("./models")]).then(()=>D(!0))})();const e=setInterval(()=>{},3e3);return()=>clearInterval(e)},[]);const de=async(e,n,a)=>{T(" (".concat(n.api_body.keyword,") ").concat(e,","));const o=[...b,{user:e}];F([...o]);try{console.log("api call on listen...",n),X(!0),d.a.stopListening(),ne(!1),console.log("Stopping Listening, isListening=",te);const e={tigger_type:a,api_key:_,text:o,self_image:N,face_data:$.current,refresh_ask:v,client_user:S,force_db_root:k,session_listen:W,before_trigger_vars:Q};console.log("api");const{data:r}=await c.a.post(t,e);console.log("data :>> ",r,e),r.self_image&&r.self_image!==N&&ce(r.self_image),F(r.text),b=[...r.text],ee.current&&ee.current.pause();const i="".concat(x).concat(r.audio_path);ee.current=new Audio(i),ee.current.play(),V(!0),le("Speaking"),await new Promise(e=>{ee.current.onended=()=>{console.log("Audio playback finished."),e()}}),ie("Click and Ask"),le("Listening"),V(!1),X(!1),console.log("Audio ENDED MOVE TO SET VARS ."),P(r.listen_after_reply),console.log("listen after reply",r.listen_after_reply),!1!==r.page_direct&&null!==r.page_direct&&(console.log("api has page direct",r.page_direct),window.location.href=r.page_direct),1!=A||J||ae?J?K(!1):ae?oe(!1):(pe(),le("listeing for key word")):(pe(),le("Awaiting your Answer please speak")),console.log("listing end",te)}catch(error){console.log("api call on listen failed!",error),X(!1),K(!1)}};return Object(a.useEffect)(()=>{const e=()=>{window.resizeBy(0,1)};return window.addEventListener("RESPONSE_FINISH_EVENT",e),()=>{window.removeEventListener("RESPONSE_FINISH_EVENT",e)}},[]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"p-2"},o.a.createElement("div",{style:{display:"flex",flexDirection:"row",width:"100%"}},o.a.createElement("div",{style:{flex:1}},j&&j.toLowerCase().endsWith(".mp4")?o.a.createElement("video",{height:i||100,width:s||100,controls:!0,autoPlay:!0,loop:!1,muted:!0},o.a.createElement("source",{src:j,type:"video/mp4"}),"Your browser does not support the video tag."):o.a.createElement("img",{src:j,height:i||100,width:s||100}),Y&&o.a.createElement("div",{style:{position:"relative",top:"10px",left:"0",width:"100%",height:"10px",backgroundImage:"linear-gradient(90deg, blue, transparent 50%, blue)",animation:"flashLine 1s infinite"}},o.a.createElement("div",{style:{position:"relative",top:"-20px",left:"50%",transform:"translateX(-50%)",color:"black",fontSize:"14px"}},"One Moment please")),G&&o.a.createElement("div",{style:{position:"relative",width:"100%",height:"100%"}},G&&o.a.createElement("div",{style:{position:"absolute",top:"10px",left:"0",width:"100%",height:"20px",background:"linear-gradient(to right, blue, transparent, purple)",animation:"waveAnimation 1s infinite",borderRadius:"10px"}},o.a.createElement("div",{style:{position:"absolute",top:"-30px",left:"50%",transform:"translateX(-50%)",color:"black",fontSize:"14px"}},"Speaking"))),te&&o.a.createElement("div",{style:{position:"relative",top:"10px",left:"0",width:"100%",height:"10px",backgroundImage:"linear-gradient(90deg, green, transparent 50%, green)",animation:"flashLine 1s infinite"}},o.a.createElement("div",{style:{position:"absolute",top:"-30px",left:"50%",transform:"translateX(-89%)",color:"black",fontSize:"14px"}},se)),W&&o.a.createElement("div",{style:{position:"relative",top:"-10px",right:"50",left:"0",width:"50%",height:"10px",backgroundImage:"linear-gradient(90deg, orange, transparent 50%, orange)",animation:"flashLine 1s infinite"}},o.a.createElement("div",{style:{position:"relative",top:"-20px",left:"50%",transform:"translateX(-50%)",color:"black",fontSize:"14px"}},"Session Started"))),o.a.createElement("div",{style:{flex:1,overflowY:"auto",maxHeight:"400px"}},!0===p&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null," You: ",I),C.map((e,t)=>o.a.createElement("div",{key:t,style:{marginBottom:"5px"}},o.a.createElement("div",{style:{backgroundColor:e.resp?"#f2f2f2":"lightblue",padding:"5px",borderRadius:"5px"}},"-user: ",o.a.createElement("span",{dangerouslySetInnerHTML:{__html:f.a.sanitize(e.user)}})),o.a.createElement("div",{style:{backgroundColor:e.resp?"lightyellow":"#f2f2f2",padding:"5px",borderRadius:"5px"}},"-resp: ",o.a.createElement("span",{dangerouslySetInnerHTML:{__html:f.a.sanitize(e.resp||"thinking...")}}))))))),o.a.createElement("div",{style:{display:"flex",marginTop:"10px"}},o.a.createElement("button",{style:{flex:1,marginRight:"5px",backgroundColor:"#3498db",color:"white",padding:"10px",border:"2px solid #2980b9",cursor:"pointer"},onClick:()=>{K(!0),pe(),ie("Please Speak"),console.log("listening button listen click"),console.log(J)}},re),o.a.createElement("button",{style:{flex:1,marginLeft:"5px",backgroundColor:"#2980b9",color:"white",padding:"10px",border:"2px solid #2980b9",cursor:"pointer"},onClick:pe},"Conversational Mode"),o.a.createElement("button",{style:{flex:1,marginLeft:"5px",backgroundColor:"#2980b9",color:"white",padding:"10px",border:"2px solid #2980b9",cursor:"pointer"},onClick:()=>{q(!W)}},"Start A Session")),o.a.createElement("div",{className:"p-2"},o.a.createElement(g,{commands:r,myFunc:de,listenAfterReply:A,no_response_time:E,show_conversation:p,apiInProgress:Y,listenButton:J,session_listen:W})),h&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{className:"form-control",type:"text",placeholder:"Chat with Me",value:z,onChange:e=>{B(e.target.value),oe(!0)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",z),de(z,{api_body:{keyword:""}},4),B(""))}})),o.a.createElement("hr",{style:{margin:"20px 0"}})," ")))};var E=Object(l.b)(e=>{const{api:t,kwargs:n}=e.args;return Object(a.useEffect)(()=>l.a.setFrameHeight()),o.a.createElement(o.a.Fragment,null,o.a.createElement(h,{api:t,kwargs:n}))}),y=n(56),_=n(25),v=n(54),w=n(45);const x=new y.a;s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(_.a,{value:x},o.a.createElement(v.a,{theme:w.a},o.a.createElement(E,null)))),document.getElementById("root"))}},[[26,1,2]]]);
//# sourceMappingURL=main.d988ede3.chunk.js.map