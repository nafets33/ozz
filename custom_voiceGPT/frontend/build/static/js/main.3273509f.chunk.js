(this.webpackJsonpstreamlit_custom_voice_gpt=this.webpackJsonpstreamlit_custom_voice_gpt||[]).push([[0],{20:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=20},25:function(e,t,n){e.exports=n(43)},43:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(21),l=n.n(o),s=n(8),c=n(54),i=n(4),u=n.n(i);var d=e=>{let{commands:t,myFunc:n,listenAfterReply:o=!1,noResponseTime:l=1,show_conversation:s=!0,apiInProgress:c=!1,listenButton:u=!1}=e;const[d,p]=Object(r.useState)(!0),[m,g]=Object(r.useState)(!0),{finalTranscript:f,resetTranscript:h,listening:b,browserSupportsSpeechRecognition:E,isMicrophoneAvailable:y}=Object(i.useSpeechRecognition)({transcribing:d,clearTranscriptOnListen:m}),[w,v]=Object(r.useState)("");return Object(r.useEffect)(()=>{if(""!==f){if(console.log("Got final result:",f),console.log("listening?",b),console.log("listenAfterReply:",o),f.split(" ").length>89)return console.log("Transcript exceeds 89 words. Clearing."),void h();v(f);const e=setTimeout(()=>{for(let e=0;e<t.length;e++){const{keywords:r,api_body:a}=t[e];for(let l=0;l<r.length;l++){const a=new RegExp(r[l],"i"),s=-1!==f.search(a);if(console.log("listenAfterReply:",o),(s||o||u)&&!c)return o?n(f,{api_body:{keyword:""}},3):s?n(f,t[e],1):u&&n(f,t[e],5),void h()}}console.log("Waiting for a keyword or API is in progress")},1e3*l);return()=>clearTimeout(e)}},[f,o,t,l,h,c,u]),E?y?a.a.createElement(a.a.Fragment,null,s&&a.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},a.a.createElement("span",null,"You said: ",w),a.a.createElement("span",null,"Listening: ",b?"on":"off"),a.a.createElement("span",null,"Clear Transcript On Listen: ",m?"on":"off"))):a.a.createElement("span",null,"Please allow access to the microphone"):a.a.createElement("span",null,"No browser support")},p=n(3);let m=[],g=!1;var f=e=>{const{api:t,kwargs:n={}}=e,{commands:o,height:l,width:i,show_conversation:f,show_video:h,input_text:b,no_response_time:E,face_recon:y,api_key:w,refresh_ask:v,before_trigger:_,api_audio:x,client_user:O}=n,[k,j]=Object(r.useState)(n.self_image),[S,R]=Object(r.useState)(""),[F,C]=Object(r.useState)([]),[T,L]=Object(r.useState)(!1),[N,A]=Object(r.useState)(!1),[D,I]=Object(r.useState)(!1),[P,U]=Object(r.useState)(""),[M,z]=Object(r.useState)(!1),[B,G]=Object(r.useState)(!1),H=Object(r.useRef)([]),W=Object(r.useRef)(!1),Y=Object(r.useRef)(),J=Object(r.useRef)(),K=Object(r.useRef)(null),[V,X]=Object(r.useState)(!0),[q,Q]=Object(r.useState)(!1),Z=async(e,n,r)=>{R(" (".concat(n.api_body.keyword,") ").concat(e,","));const a=[...m,{user:e}];C([...a]);try{console.log("api call on listen...",n),z(!0),$();const e={tigger_type:r,api_key:w,text:a,self_image:k,face_data:H.current,refresh_ask:v,client_user:O};console.log("api");const{data:o}=await c.a.post(t,e);console.log("data :>> ",o,e),o.self_image&&j(o.self_image),K.current&&K.current.pause();const l="".concat(x).concat(o.audio_path);K.current=new Audio(l),K.current.play(),await new Promise(e=>{K.current.onended=()=>{console.log("Audio playback finished."),e()}}),console.log("Audio ENDED MOVE TO SET VARS ."),C(o.text),m=[...o.text],L(o.listen_after_reply),console.log("listen after reply",o.listen_after_reply),!1!==o.page_direct&&null!==o.page_direct&&(console.log("api has page direct",o.page_direct),window.location.href=o.page_direct),B?(G(!1),T&&ee()):ee(),z(!1)}catch(error){console.log("api call on listen failed!",error),z(!1),G(!1)}};Object(r.useEffect)(()=>{s.a.setFrameHeight();const e=setInterval(()=>{u.a.browserSupportsContinuousListening()||(console.log("LISTEN STOPPED TURNING BACK ON",error),ee())},6e4);return()=>{clearInterval(e)}},[]);const $=()=>{u.a.stopListening()},ee=()=>u.a.startListening({continuous:!0,language:"en-GB"});return Object(r.useEffect)(()=>{(async()=>{Promise.all([p.f.tinyFaceDetector.loadFromUri("./models"),p.f.faceLandmark68Net.loadFromUri("./models"),p.f.faceRecognitionNet.loadFromUri("./models"),p.f.faceExpressionNet.loadFromUri("./models"),p.f.ageGenderNet.loadFromUri("./models")]).then(()=>A(!0))})();const e=setInterval(()=>{console.log("faceData.current :>> ",H.current)},3e3);return()=>clearInterval(e)},[]),a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"p-2"},a.a.createElement("div",{style:{position:"relative",display:"flex",flexDirection:"column",width:"100%"}},a.a.createElement("div",{style:{position:"relative"}},k&&k.toLowerCase().endsWith(".mp4")?a.a.createElement("video",{height:l||100,width:i||100,controls:!0,autoPlay:!0,loop:!1,muted:!0},a.a.createElement("source",{src:k,type:"video/mp4"}),"Your browser does not support the video tag."):a.a.createElement("img",{src:k,height:l||100,width:i||100}),M&&a.a.createElement("div",{style:{position:"absolute",top:"10px",left:"0",width:"100%",height:"4px",backgroundImage:"linear-gradient(90deg, green, transparent 50%, green)",animation:"flashLine 1s infinite"}},a.a.createElement("div",{style:{position:"absolute",top:"-20px",left:"50%",transform:"translateX(-50%)",color:"white",fontSize:"14px"}},"Your words here"))),a.a.createElement("div",{style:{display:"flex",width:"100%",marginTop:"10px"}},a.a.createElement("button",{style:{flex:1,marginRight:"5px",backgroundColor:"#3498db",color:"white",padding:"10px",border:"2px solid #2980b9",cursor:"pointer"},onClick:()=>{G(!0),ee(),console.log("listening button listen click"),console.log(B)}},"Ask Ozz"),a.a.createElement("button",{style:{flex:1,marginLeft:"5px",backgroundColor:"#2980b9",color:"white",padding:"10px",border:"2px solid #2980b9",cursor:"pointer"},onClick:ee},"Listening"))),a.a.createElement("div",{className:"p-2"},a.a.createElement(d,{commands:o,myFunc:Z,listenAfterReply:T,noResponseTime:E,show_conversation:f,apiInProgress:M,listenButton:B})),b&&a.a.createElement("div",{className:"form-group"},a.a.createElement("input",{className:"form-control",type:"text",placeholder:"Chat with Hoots",value:P,onChange:e=>{const{value:t}=e.target;U(t)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",P),Z(P,{api_body:{keyword:""}},4),U(""))}})),!0===f&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",null," You: ",S),F.map((e,t)=>a.a.createElement("div",{key:t},a.a.createElement("div",null,"-user: ",e.user),a.a.createElement("div",null,"-resp: ",e.resp?e.resp:"thinking..."))))),a.a.createElement("div",null),a.a.createElement("div",null,y&&a.a.createElement("div",{style:{textAlign:"center",padding:"10px"}},D&&N?a.a.createElement("button",{onClick:()=>{Y.current.pause(),Y.current.srcObject.getTracks()[0].stop(),I(!1)},style:{cursor:"pointer",backgroundColor:"green",color:"white",padding:"15px",fontSize:"25px",border:"none",borderRadius:"10px"}},"Close Webcam"):a.a.createElement("button",{onClick:()=>{I(!0),navigator.mediaDevices.getUserMedia({video:{width:300}}).then(e=>{let t=Y.current;t.srcObject=e,t.play()}).catch(e=>{console.error("error:",e)})},style:{cursor:"pointer",backgroundColor:"green",color:"white",padding:"15px",fontSize:"25px",border:"none",borderRadius:"10px"}},"Open Webcam")),D?N?a.a.createElement("div",null,a.a.createElement("div",{style:{display:"flex",justifyContent:"center",padding:"10px",position:h?"":"absolute",opacity:h?1:.3}},a.a.createElement("video",{ref:Y,height:480,width:640,onPlay:()=>{setInterval(async()=>{if(J&&J.current){J.current.innerHTML=p.b(Y.current);const e={width:640,height:480};p.e(J.current,e);const t=await p.c(Y.current,new p.a).withFaceLandmarks().withFaceExpressions(),r=p.g(t,e);if(r.length>0?(H.current=r,!W.current&&y&&(Z("",{api_body:{keyword:""}},2),W.current=!0)):setTimeout(()=>{H.current=[]},1e3),r.length>0&&!g&&(g=!0,n.hello_audio)){new Audio(n.hello_audio).play()}J&&J.current&&J.current.getContext("2d").clearRect(0,0,640,480),J&&J.current&&p.d.drawDetections(J.current,r),J&&J.current&&p.d.drawFaceLandmarks(J.current,r),J&&J.current&&p.d.drawFaceExpressions(J.current,r)}},300)},style:{borderRadius:"10px"}}),a.a.createElement("canvas",{ref:J,style:{position:"absolute"}}))):a.a.createElement("div",null,"loading..."):a.a.createElement(a.a.Fragment,null)))};var h=Object(s.b)(e=>{const{api:t,kwargs:n}=e.args;return Object(r.useEffect)(()=>s.a.setFrameHeight()),a.a.createElement(a.a.Fragment,null,a.a.createElement(f,{api:t,kwargs:n}))}),b=n(55),E=n(24),y=n(53),w=n(44);const v=new b.a;l.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(E.a,{value:v},a.a.createElement(y.a,{theme:w.a},a.a.createElement(h,null)))),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.3273509f.chunk.js.map