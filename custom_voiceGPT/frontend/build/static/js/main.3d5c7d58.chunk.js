(this.webpackJsonpstreamlit_custom_voice_gpt=this.webpackJsonpstreamlit_custom_voice_gpt||[]).push([[0],{20:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=20},25:function(e,t,a){e.exports=a(44)},44:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(21),s=a.n(o),l=a(8),c=a(55),d=a(5),p=a.n(d);var g=e=>{let{commands:t,myFunc:a,listenAfterReply:o=!1,no_response_time:s=3,show_conversation:l=!0,apiInProgress:c=!1,listenButton:p=!1,session_listen:g=!1}=e;const[u,m]=Object(n.useState)(!0),[f,b]=Object(n.useState)(!0),{finalTranscript:h,resetTranscript:x,listening:E,browserSupportsSpeechRecognition:y,isMicrophoneAvailable:_}=Object(d.useSpeechRecognition)({transcribing:u,clearTranscriptOnListen:f}),[w,v]=Object(n.useState)("");return Object(n.useEffect)(()=>{if(""!==h){if(console.log("Got final result:",h),console.log("listening?",E),console.log("listenAfterReply:",o),g&&h.split(" ").length>5e5)return console.log("Transcript exceeds X words"),a(h,t[i],6),void x();if(0==g&&h.split(" ").length>1e4)return console.log("Transcript exceeds 89 words. Clearing You really should call func-api to save ."),void x();v(h);const e=setTimeout(()=>{for(let e=0;e<t.length;e++){const{keywords:n,api_body:r}=t[e];for(let i=0;i<n.length;i++){const r=new RegExp(n[i],"i"),s=-1!==h.search(r);if((s||o||p)&&!c)return o?a(h,{api_body:{keyword:""}},3):s?a(h,t[e],1):p&&a(h,t[e],5),void x()}}console.log("Waiting for a keyword or API is in progress")},1e3*s);return()=>clearTimeout(e)}},[h,o,t,s,x,c,p]),y?_?r.a.createElement(r.a.Fragment,null,l&&r.a.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"200px",overflowY:"auto",border:"1px solid #ccc",padding:"10px"}},r.a.createElement("span",null,"You said: ",w),r.a.createElement("span",null,"Listening: ",E?"on":"off"))):r.a.createElement("span",null,"Please allow access to the microphone"):r.a.createElement("span",null,"No browser support")},u=a(3);a(37);let m=[];var f=e=>{var t;const{api:a,kwargs:o={}}=e,{commands:i,height:s,width:d,show_conversation:f,show_video:b,input_text:h,no_response_time:x,face_recon:E,api_key:y,refresh_ask:_,self_image:w,api_audio:v,client_user:S,force_db_root:k,before_trigger:O}=o,[j,R]=Object(n.useState)(o.self_image),[L,N]=Object(n.useState)(o.self_image),[A,T]=Object(n.useState)(""),[I,C]=Object(n.useState)([]),[F,P]=Object(n.useState)(!1),[z,H]=Object(n.useState)(!1),[U,D]=Object(n.useState)(!1),[B,M]=Object(n.useState)(""),[W,Y]=Object(n.useState)(!1),[G,V]=Object(n.useState)(!1),[J,K]=Object(n.useState)(!1),[X,q]=Object(n.useState)(!1),[Q,Z]=Object(n.useState)(o.before_trigger),$=Object(n.useRef)([]),ee=(Object(n.useRef)(!1),Object(n.useRef)(),Object(n.useRef)(),Object(n.useRef)(null)),[te,ae]=Object(n.useState)(!1),[ne,re]=Object(n.useState)(!1),[oe,ie]=Object(n.useState)("Click and Ask"),[se,le]=Object(n.useState)("Listening"),[ce,de]=Object(n.useState)(!1);Object(n.useEffect)(()=>{const e=()=>{setWindowWidth(window.innerWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),Object(n.useEffect)(()=>{w&&pe(w)},[w]);const pe=async e=>{try{const t=await c.a.get("".concat(v).concat(e),{responseType:"blob"}),a=URL.createObjectURL(t.data);R(a),N(e)}catch(error){console.error("Error fetching image data:",error)}};Object(n.useEffect)(()=>{l.a.setFrameHeight();const e=setInterval(()=>{p.a.browserSupportsContinuousListening()||(console.log("LISTEN STOPPED TURNING BACK ON",error),ge())},6e4);return()=>{clearInterval(e)}},[]);const ge=()=>{te?ae(!1):(p.a.startListening({continuous:!0,language:"en-GB"}),ae(!0))};Object(n.useEffect)(()=>{(async()=>{Promise.all([u.f.tinyFaceDetector.loadFromUri("./models"),u.f.faceLandmark68Net.loadFromUri("./models"),u.f.faceRecognitionNet.loadFromUri("./models"),u.f.faceExpressionNet.loadFromUri("./models"),u.f.ageGenderNet.loadFromUri("./models")]).then(()=>H(!0))})();const e=setInterval(()=>{},3e3);return()=>clearInterval(e)},[]);const ue=async(e,t,n)=>{T(" (".concat(t.api_body.keyword,") ").concat(e,","));const r=[...m,{user:e}];C([...r]);try{console.log("api call on listen...",t),Y(!0),p.a.stopListening(),ae(!1),console.log("Stopping Listening, isListening=",te);const e={tigger_type:n,api_key:y,text:r,self_image:L,face_data:$.current,refresh_ask:_,client_user:S,force_db_root:k,session_listen:X,before_trigger_vars:Q};console.log("api");const{data:o}=await c.a.post(a,e);if(console.log("data :>> ",o,e),o.self_image&&o.self_image!==L&&pe(o.self_image),C(o.text),m=[...o.text],ee.current&&ee.current.pause(),o.audio_path){const e="".concat(v).concat(o.audio_path);ee.current=new Audio(e);try{await ee.current.play(),V(!0),le("Speaking"),await new Promise(e=>{ee.current.onended=()=>{console.log("Audio playback finished."),e()}})}catch(error){console.error("Audio playback error:",error)}finally{ee.current=null,V(!1),le("Listen")}}ie("Click and Ask"),le("Listening"),V(!1),Y(!1),console.log("Audio ENDED MOVE TO SET VARS ."),P(o.listen_after_reply),console.log("listen after reply",o.listen_after_reply),!1!==o.page_direct&&null!==o.page_direct&&(console.log("api has page direct",o.page_direct),window.location.href=o.page_direct),1!=F||J||ne?J?K(!1):ne?re(!1):(ge(),le("listeing for key word")):(ge(),le("Awaiting your Answer please speak")),console.log("listing end",te)}catch(error){console.log("api call on listen failed!",error),Y(!1),K(!1)}};Object(n.useEffect)(()=>{const e=()=>{window.resizeBy(0,1)};return window.addEventListener("RESPONSE_FINISH_EVENT",e),()=>{window.removeEventListener("RESPONSE_FINISH_EVENT",e)}},[]);const me=(null===(t=_.color_dict)||void 0===t?void 0:t.background_color_chat)||"transparent",fe=w.split(".")[0],be="Chat with ".concat(fe);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"p-2"},r.a.createElement("div",{style:{display:"flex",flexDirection:"row",width:"100%"}},ce&&r.a.createElement("div",{style:{flex:1}},j&&(j.toLowerCase().endsWith(".mp4")?r.a.createElement("video",{style:{maxWidth:"100%"},height:s||100,width:d||100,controls:!0,autoPlay:!0,loop:!1,muted:!0},r.a.createElement("source",{src:j,type:"video/mp4"}),"Your browser does not support the video tag."):r.a.createElement("img",{src:j,height:s||100,width:d||100,style:{maxWidth:"100%"}}))),r.a.createElement("div",{style:{flex:ce?1:"100%",overflowY:"auto",maxHeight:"400px"}},f&&r.a.createElement("div",{style:{border:"2px solid #2980b9",borderRadius:"6px",overflowY:"auto",maxHeight:"400px",padding:"10px"}},I.map((e,t)=>r.a.createElement("div",{key:t,style:{marginBottom:"5px",padding:"5px",borderRadius:"4px",border:"1px solid #ccc",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}},r.a.createElement("div",{className:"chat-user",style:{backgroundColor:"#f2f2f2",textAlign:"right",marginLeft:"auto",padding:"5px"}},S,": ",r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.user}})),r.a.createElement("div",{className:"chat-resp",style:{display:"flex",alignItems:"flex-start",backgroundColor:me}},r.a.createElement("div",{className:"chat-image",style:{marginRight:"10px"}},r.a.createElement("img",{src:j,alt:"response",style:{width:"50px"}})," "),r.a.createElement("div",{style:{flex:1}}," ",r.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.resp||"thinking..."}})))))))),h&&r.a.createElement(r.a.Fragment,null,r.a.createElement("hr",{style:{margin:"20px 0"}}),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{className:"form-control",type:"text",placeholder:be,value:B,onChange:e=>{M(e.target.value),re(!0)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",B),ue(B,{api_body:{keyword:""}},4),M(""))}})),r.a.createElement("hr",{style:{margin:"20px 0"}})),r.a.createElement("div",{style:{display:"flex",marginTop:"10px"}},r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:"#3498db",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer"},onClick:()=>{K(!0),ge(),ie("Please Speak"),console.log("listening button listen click"),console.log(J)}},oe),te&&r.a.createElement("div",{style:{width:"100%",height:"10px",backgroundImage:"linear-gradient(90deg, green, transparent 50%, green)",animation:"flashLine 1s infinite",marginTop:"5px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},se))),r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:"#2980b9",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer"},onClick:ge},"Conversational Mode"),G&&r.a.createElement("div",{style:{width:"100%",height:"10px",background:"linear-gradient(to right, blue, transparent, purple)",animation:"waveAnimation 1s infinite",marginTop:"5px",borderRadius:"10px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},"Speaking"))),r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:"#2980b9",color:"white",border:"1px solid #2980b9",borderRadius:"4px",cursor:"pointer"},onClick:()=>{q(!X)}},"Start A Session"),X&&r.a.createElement("div",{style:{width:"100%",height:"10px",backgroundImage:"linear-gradient(90deg, orange, transparent 50%, orange)",animation:"flashLine 1s infinite",marginTop:"5px"}},r.a.createElement("div",{style:{fontSize:"12px",color:"black"}},"Session Started"))),r.a.createElement("div",{style:{flex:1,textAlign:"center"}},r.a.createElement("button",{style:{fontSize:"12px",padding:"5px",margin:"5px 0",backgroundColor:"#7f8c8d",color:"white",border:"1px solid #7f8c8d",borderRadius:"4px",cursor:"pointer"},onClick:()=>{de(e=>!e)}},ce?"Hide Image":"Show Image"))),r.a.createElement("div",{className:"p-2"},r.a.createElement(g,{commands:i,myFunc:ue,listenAfterReply:F,no_response_time:x,show_conversation:f,apiInProgress:W,listenButton:J,session_listen:X}))))};var b=Object(l.b)(e=>{const{api:t,kwargs:a}=e.args;return Object(n.useEffect)(()=>l.a.setFrameHeight()),r.a.createElement(r.a.Fragment,null,r.a.createElement(f,{api:t,kwargs:a}))}),h=a(56),x=a(24),E=a(54),y=a(45);const _=new h.a;s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(x.a,{value:_},r.a.createElement(E.a,{theme:y.a},r.a.createElement(b,null)))),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.3d5c7d58.chunk.js.map