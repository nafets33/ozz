(this.webpackJsonpstreamlit_custom_voice_gpt=this.webpackJsonpstreamlit_custom_voice_gpt||[]).push([[0],{20:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=20},25:function(e,t,a){e.exports=a(43)},43:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),r=a(21),i=a.n(r),l=a(8),s=a(54),c=a(4),p=a.n(c);var d=e=>{let{commands:t,myFunc:a,listenAfterReply:r=!1,no_response_time:i=3,show_conversation:l=!0,apiInProgress:s=!1,listenButton:p=!1}=e;const[d,u]=Object(n.useState)(!0),[g,m]=Object(n.useState)(!0),{finalTranscript:f,resetTranscript:b,listening:h,browserSupportsSpeechRecognition:E,isMicrophoneAvailable:y}=Object(c.useSpeechRecognition)({transcribing:d,clearTranscriptOnListen:g}),[v,w]=Object(n.useState)("");return Object(n.useEffect)(()=>{if(""!==f){if(console.log("Got final result:",f),console.log("listening?",h),console.log("listenAfterReply:",r),f.split(" ").length>1e5)return console.log("Transcript exceeds 89 words. Clearing You really should call func-api to save ."),void b();w(f);const e=setTimeout(()=>{for(let e=0;e<t.length;e++){const{keywords:n,api_body:o}=t[e];for(let i=0;i<n.length;i++){const o=new RegExp(n[i],"i"),l=-1!==f.search(o);if((l||r||p)&&!s)return r?a(f,{api_body:{keyword:""}},3):l?a(f,t[e],1):p&&a(f,t[e],5),void b()}}console.log("Waiting for a keyword or API is in progress")},1e3*i);return()=>clearTimeout(e)}},[f,r,t,i,b,s,p]),E?y?o.a.createElement(o.a.Fragment,null,l&&o.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},o.a.createElement("span",null,"You said: ",v),o.a.createElement("span",null,"Listening: ",h?"on":"off"))):o.a.createElement("span",null,"Please allow access to the microphone"):o.a.createElement("span",null,"No browser support")},u=a(3);let g=[];var m=e=>{const{api:t,kwargs:a={}}=e,{commands:r,height:i,width:c,show_conversation:m,show_video:f,input_text:b,no_response_time:h,face_recon:E,api_key:y,refresh_ask:v,self_image:w,api_audio:_,client_user:x,force_db_root:S}=a,[k,O]=Object(n.useState)(a.self_image),[j,L]=Object(n.useState)(a.self_image),[N,R]=Object(n.useState)(""),[C,F]=Object(n.useState)([]),[I,A]=Object(n.useState)(!1),[T,P]=Object(n.useState)(!1),[U,D]=Object(n.useState)(!1),[B,M]=Object(n.useState)(""),[z,H]=Object(n.useState)(!1),[Y,G]=Object(n.useState)(!1),[V,X]=Object(n.useState)(!1),[J,K]=Object(n.useState)(!1),W=Object(n.useRef)([]),q=(Object(n.useRef)(!1),Object(n.useRef)(),Object(n.useRef)(),Object(n.useRef)(null)),[Q,Z]=Object(n.useState)(!1),[$,ee]=Object(n.useState)(!1),[te,ae]=Object(n.useState)("Click and Ask"),[ne,oe]=Object(n.useState)("Listening");Object(n.useEffect)(()=>{w&&re(w)},[w]);const re=async e=>{try{const t=await s.a.get("".concat(_).concat(e),{responseType:"blob"}),a=URL.createObjectURL(t.data);O(a),L(e)}catch(error){console.error("Error fetching image data:",error)}};Object(n.useEffect)(()=>{l.a.setFrameHeight();const e=setInterval(()=>{p.a.browserSupportsContinuousListening()||(console.log("LISTEN STOPPED TURNING BACK ON",error),ie())},6e4);return()=>{clearInterval(e)}},[]);const ie=()=>{p.a.startListening({continuous:!0,language:"en-GB"}),Z(!0)};Object(n.useEffect)(()=>{(async()=>{Promise.all([u.f.tinyFaceDetector.loadFromUri("./models"),u.f.faceLandmark68Net.loadFromUri("./models"),u.f.faceRecognitionNet.loadFromUri("./models"),u.f.faceExpressionNet.loadFromUri("./models"),u.f.ageGenderNet.loadFromUri("./models")]).then(()=>P(!0))})();const e=setInterval(()=>{},3e3);return()=>clearInterval(e)},[]);const le=async(e,a,n)=>{R(" (".concat(a.api_body.keyword,") ").concat(e,","));const o=[...g,{user:e}];F([...o]);try{console.log("api call on listen...",a),H(!0),p.a.stopListening(),Z(!1),console.log("Stopping Listening, isListening=",Q);const e={tigger_type:n,api_key:y,text:o,self_image:j,face_data:W.current,refresh_ask:v,client_user:x,force_db_root:S,session_listen:J};console.log("api");const{data:r}=await s.a.post(t,e);console.log("data :>> ",r,e),r.self_image&&r.self_image!==j&&re(r.self_image),F(r.text),g=[...r.text],q.current&&q.current.pause();const i="".concat(_).concat(r.audio_path);q.current=new Audio(i),q.current.play(),G(!0),oe("Speaking"),await new Promise(e=>{q.current.onended=()=>{console.log("Audio playback finished."),e()}}),ae("Click and Ask"),oe("Listening"),G(!1),H(!1),console.log("Audio ENDED MOVE TO SET VARS ."),A(r.listen_after_reply),console.log("listen after reply",r.listen_after_reply),!1!==r.page_direct&&null!==r.page_direct&&(console.log("api has page direct",r.page_direct),window.location.href=r.page_direct),!I||V||$?V?X(!1):$?ee(!1):(ie(),oe("listeing waiting for key word --\x3e stefan")):(ie(),oe("Awaiting your Answer please speak")),console.log("listing end",Q)}catch(error){console.log("api call on listen failed!",error),H(!1),X(!1)}};return Object(n.useEffect)(()=>{const e=()=>{window.resizeBy(0,1)};return window.addEventListener("RESPONSE_FINISH_EVENT",e),()=>{window.removeEventListener("RESPONSE_FINISH_EVENT",e)}},[]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"p-2"},o.a.createElement("div",{style:{display:"flex",flexDirection:"row",width:"100%"}},o.a.createElement("div",{style:{flex:1}},k&&k.toLowerCase().endsWith(".mp4")?o.a.createElement("video",{height:i||100,width:c||100,controls:!0,autoPlay:!0,loop:!1,muted:!0},o.a.createElement("source",{src:k,type:"video/mp4"}),"Your browser does not support the video tag."):o.a.createElement("img",{src:k,height:i||100,width:c||100}),z&&o.a.createElement("div",{style:{position:"relative",top:"10px",left:"0",width:"100%",height:"10px",backgroundImage:"linear-gradient(90deg, blue, transparent 50%, blue)",animation:"flashLine 1s infinite"}},o.a.createElement("div",{style:{position:"relative",top:"-20px",left:"50%",transform:"translateX(-50%)",color:"black",fontSize:"14px"}},"One Moment please")),Y&&o.a.createElement("div",{style:{position:"relative",top:"10px",left:"0",width:"100%",height:"20px",background:"linear-gradient(to right, blue, transparent, purple)",animation:"waveAnimation 1s infinite",borderRadius:"10px"}},o.a.createElement("div",{style:{position:"relative",top:"-30px",left:"50%",transform:"translateX(-50%)",color:"black",fontSize:"14px"}},"Speaking")),Q&&o.a.createElement("div",{style:{position:"relative",top:"10px",left:"0",width:"100%",height:"10px",backgroundImage:"linear-gradient(90deg, green, transparent 50%, green)",animation:"flashLine 1s infinite"}},o.a.createElement("div",{style:{position:"relative",top:"-20px",left:"50%",transform:"translateX(-50%)",color:"black",fontSize:"14px"}},ne)),J&&o.a.createElement("div",{style:{position:"relative",top:"-10px",right:"50",left:"0",width:"50%",height:"10px",backgroundImage:"linear-gradient(90deg, orange, transparent 50%, orange)",animation:"flashLine 1s infinite"}},o.a.createElement("div",{style:{position:"relative",top:"-20px",left:"50%",transform:"translateX(-50%)",color:"black",fontSize:"14px"}},"Session Started"))),o.a.createElement("div",{style:{flex:1,overflowY:"auto",maxHeight:"400px"}},!0===m&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null," You: ",N),C.map((e,t)=>o.a.createElement("div",{key:t,style:{marginBottom:"5px"}},o.a.createElement("div",{style:{backgroundColor:e.resp?"#f2f2f2":"lightblue",padding:"5px",borderRadius:"5px"}},"-user: ",e.user),o.a.createElement("div",{style:{backgroundColor:e.resp?"lightyellow":"#f2f2f2",padding:"5px",borderRadius:"5px"}},"-resp: ",e.resp?e.resp:"thinking...")))))),o.a.createElement("div",{style:{display:"flex",marginTop:"10px"}},o.a.createElement("button",{style:{flex:1,marginRight:"5px",backgroundColor:"#3498db",color:"white",padding:"10px",border:"2px solid #2980b9",cursor:"pointer"},onClick:()=>{X(!0),ie(),ae("Please Speak"),console.log("listening button listen click"),console.log(V)}},te),o.a.createElement("button",{style:{flex:1,marginLeft:"5px",backgroundColor:"#2980b9",color:"white",padding:"10px",border:"2px solid #2980b9",cursor:"pointer"},onClick:ie},"Conversational Mode"),o.a.createElement("button",{style:{flex:1,marginLeft:"5px",backgroundColor:"#2980b9",color:"white",padding:"10px",border:"2px solid #2980b9",cursor:"pointer"},onClick:()=>{K(!J)}},"Start A Session")),o.a.createElement("div",{className:"p-2"},o.a.createElement(d,{commands:r,myFunc:le,listenAfterReply:I,no_response_time:h,show_conversation:m,apiInProgress:z,listenButton:V})),b&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"form-group"},o.a.createElement("input",{className:"form-control",type:"text",placeholder:"Chat with Me",value:B,onChange:e=>{M(e.target.value),ee(!0)},onKeyDown:e=>{"Enter"===e.key&&(console.log("textString :>> ",B),le(B,{api_body:{keyword:""}},4),M(""))}})),o.a.createElement("hr",{style:{margin:"20px 0"}})," ")))};var f=Object(l.b)(e=>{const{api:t,kwargs:a}=e.args;return Object(n.useEffect)(()=>l.a.setFrameHeight()),o.a.createElement(o.a.Fragment,null,o.a.createElement(m,{api:t,kwargs:a}))}),b=a(55),h=a(24),E=a(53),y=a(44);const v=new b.a;i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(h.a,{value:v},o.a.createElement(E.a,{theme:y.a},o.a.createElement(f,null)))),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.7274a2f5.chunk.js.map